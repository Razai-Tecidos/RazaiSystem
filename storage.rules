rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Regras para imagens de tecidos
    match /tecidos/{tecidoId}/{allPaths=**} {
      // Leitura pÃºblica (evita expiraÃ§Ã£o de tokens)
      // Escrita apenas para usuÃ¡rios autenticados
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Regras para imagens de cores (tingimentos)
    match /cores/{corId}/{allPaths=**} {
      // Leitura pÃºblica (evita expiraÃ§Ã£o de tokens)
      // Escrita apenas para usuÃ¡rios autenticados
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Regras para imagens de vÃ­nculos cor-tecido (tingidas e com marca)
    match /cor-tecido/{vinculoId}/{allPaths=**} {
      // Leitura pÃºblica (evita expiraÃ§Ã£o de tokens)
      // Escrita apenas para usuÃ¡rios autenticados
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Regras para imagens de estampas
    match /estampas/{estampaId}/{allPaths=**} {
      // Leitura pÃºblica (evita expiraÃ§Ã£o de tokens)
      // Escrita apenas para usuÃ¡rios autenticados
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Regras para modelos ML (compartilhados entre usuÃ¡rios autenticados)
    match /ml-models/{modelId}/{allPaths=**} {
      // Leitura pÃºblica para carregar modelo no frontend
      // Escrita apenas para usuÃ¡rios autenticados
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Arquivos de modelo ML na raiz (weights.bin, model.json)
    // NecessÃ¡rio porque TensorFlow.js pode resolver paths relativamente
    match /weights.bin {
      allow read: if true;
      allow write: if request.auth != null;
    }
    match /model.json {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Regras para imagens de anÃºncios Shopee
    match /shopee-anuncios/{productId}/{allPaths=**} {
      // Leitura pÃºblica (imagens podem ser usadas em anÃºncios pÃºblicos)
      // Escrita apenas para usuÃ¡rios autenticados
      allow read: if true;
      allow write: if request.auth != null;
    }
    // Regras para mosaicos da gestao de imagens
    match /mosaicos/{tecidoId}/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Negar acesso a todos os outros caminhos por padrao
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

